# Entrypoint: –ó–∞–ø—É—Å–∫ JAR-—Ñ–∞–π–ª–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JVM

_LLM-generated –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è._

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
  - [–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞](#–ø–∞—Ä–∞–º–µ—Ç—Ä—ã-–∑–∞–ø—É—Å–∫–∞)
- [–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã](#–∞–ª–≥–æ—Ä–∏—Ç–º-—Ä–∞–±–æ—Ç—ã)
  - [1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞](#1-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π-–ø–∞–º—è—Ç–∏-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
  - [2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#2-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
    - [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è-—Å–æ-–∑–Ω–∞—á–µ–Ω–∏—è–º–∏-–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é)
  - [3. –†–∞—Å—á–µ—Ç "—Å–∫–ª–∞–¥—Å–∫–∏—Ö" —Ä–µ—Å—É—Ä—Å–æ–≤](#3-—Ä–∞—Å—á–µ—Ç-—Å–∫–ª–∞–¥—Å–∫–∏—Ö-—Ä–µ—Å—É—Ä—Å–æ–≤)
  - [4. –†–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏ –¥–ª—è JVM](#4-—Ä–∞—Å—á–µ—Ç-–¥–æ—Å—Ç—É–ø–Ω–æ–π-–ø–∞–º—è—Ç–∏-–¥–ª—è-jvm)
  - [5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Non-Heap –æ–±–ª–∞—Å—Ç–µ–π JVM](#5-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-non-heap-–æ–±–ª–∞—Å—Ç–µ–π-jvm)
    - [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–ª–∞—Å—Ç–µ–π –ø–∞–º—è—Ç–∏:](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–æ–±–ª–∞—Å—Ç–µ–π-–ø–∞–º—è—Ç–∏)
  - [6. –†–∞—Å—á–µ—Ç Heap –ø–∞–º—è—Ç–∏](#6-—Ä–∞—Å—á–µ—Ç-heap-–ø–∞–º—è—Ç–∏)
    - [–≠—Ç–∞–ø 1: –ü–∞–º—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞—è –¥–ª—è Heap + GC](#—ç—Ç–∞–ø-1-–ø–∞–º—è—Ç—å-–¥–æ—Å—Ç—É–ø–Ω–∞—è-–¥–ª—è-heap--gc)
    - [–≠—Ç–∞–ø 2: –†–µ–∑–µ—Ä–≤ –¥–ª—è GC overhead](#—ç—Ç–∞–ø-2-—Ä–µ–∑–µ—Ä–≤-–¥–ª—è-gc-overhead)
    - [–≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä Heap](#—ç—Ç–∞–ø-3-—Ñ–∏–Ω–∞–ª—å–Ω—ã–π-—Ä–∞–∑–º–µ—Ä-heap)
    - [–≠—Ç–∞–ø 4: –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç MaxRAM –¥–ª—è JVM](#—ç—Ç–∞–ø-4-–ø—Ä–æ—Ü–µ–Ω—Ç-–æ—Ç-maxram-–¥–ª—è-jvm)
- [JVM —Ñ–ª–∞–≥–∏ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ](#jvm-—Ñ–ª–∞–≥–∏-–∏-–∏—Ö-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)
  - [–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞](#–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è-–ø–æ–¥–¥–µ—Ä–∂–∫–∞)
  - [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–∞–º—è—Ç—å—é)
  - [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
  - [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏](#–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–æ–ø—Ü–∏–∏)
- [–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ](#—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
- [–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞](#–ø—Ä–∏–º–µ—Ä-—Ä–∞—Å—á–µ—Ç–∞)
  - [–î–∞–Ω–æ:](#–¥–∞–Ω–æ)
  - [–†–∞—Å—á–µ—Ç:](#—Ä–∞—Å—á–µ—Ç)
  - [–†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ Java:](#—Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è-–∫–æ–º–∞–Ω–¥–∞-java)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ—Ç–ª–∞–¥–∫–∞)
  - [Verbose —Ä–µ–∂–∏–º (`-v`)](#verbose-—Ä–µ–∂–∏–º--v)
  - [–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤](#—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ-—Ä–∞–∑–º–µ—Ä—ã-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
  - [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
- [Troubleshooting](#troubleshooting)
  - [–ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç —Å OOM](#–ø—Ä–æ–±–ª–µ–º–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–ø–∞–¥–∞–µ—Ç-—Å-oom)
  - [–ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ GC](#–ø—Ä–æ–±–ª–µ–º–∞-–º–µ–¥–ª–µ–Ω–Ω–∞—è-—Ä–∞–±–æ—Ç–∞-gc)
  - [–ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–≥–æ database connections timeout](#–ø—Ä–æ–±–ª–µ–º–∞-–º–Ω–æ–≥–æ-database-connections-timeout)

## –û–±–∑–æ—Ä

–°–∫—Ä–∏–ø—Ç `entrypoint.sh` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É JVM –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã heap, non-heap –æ–±–ª–∞—Å—Ç–µ–π –∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

- **`-v`** - –≤–∫–ª—é—á–∞–µ—Ç verbose —Ä–µ–∂–∏–º —Å –≤—ã–≤–æ–¥–æ–º –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞—Å—á–µ—Ç–∞—Ö –ø–∞–º—è—Ç–∏
- **`JAR_FILE_NAME`** - –∏–º—è JAR-—Ñ–∞–π–ª–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
./entrypoint.sh -v app.jar    # –° –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
./entrypoint.sh app.jar       # –ë–µ–∑ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ cgroups –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏
if [ -f /sys/fs/cgroup/memory/memory.limit_in_bytes ]; then
    # Cgroups v1
    LIMITED_RAM_CONTAINER_CGROUP_SIZE_BYTES=$(cat /sys/fs/cgroup/memory/memory.limit_in_bytes)
elif [ -f /sys/fs/cgroup/memory.max ]; then
    # Cgroups v2
    LIMITED_RAM_CONTAINER_CGROUP_SIZE_BYTES=$(cat /sys/fs/cgroup/memory.max)
else
    # –û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–º—è—Ç–∏
    exit 1
fi
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –±–∞–π—Ç–∞—Ö.

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                    | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é         | –û–ø–∏—Å–∞–Ω–∏–µ                               |
|-------------------------------|-------------------------------|----------------------------------------|
| `TOMCAT_THREADS_MAX`          | 100                           | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ Tomcat |
| `TOMCAT_THREADS_MIN`          | = TOMCAT_THREADS_MAX          | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ Tomcat  |
| `HIKARI_DB_MAXIMUM_POOL_SIZE` | 10                            | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î |
| `HIKARI_DB_MINIMUM_IDLE_SIZE` | = HIKARI_DB_MAXIMUM_POOL_SIZE | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |
| `JVM_NATIVE_MB`               | 120                           | –†–µ–∑–µ—Ä–≤ –ø–∞–º—è—Ç–∏ –¥–ª—è native –∫–æ–¥–∞ JVM      |

### 3. –†–∞—Å—á–µ—Ç "—Å–∫–ª–∞–¥—Å–∫–∏—Ö" —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
STOCK_SIZE_MB = (TOMCAT_THREADS_MAX / 2) + HIKARI_DB_MAXIMUM_POOL_SIZE + JVM_NATIVE_MB
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
- **Tomcat –ø–æ—Ç–æ–∫–∏:** –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç ~0.5 MB –ø–∞–º—è—Ç–∏
- **–ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î:** –∫–∞–∂–¥–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ ~1 MB
- **Native –ø–∞–º—è—Ç—å JVM:** —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑–µ—Ä–≤ –¥–ª—è JNI, —Å–∂–∞—Ç–∏—è, etc.

**–ü—Ä–∏–º–µ—Ä:** –ü—Ä–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö: `(100/2) + 10 + 120 = 180 MB`

### 4. –†–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏ –¥–ª—è JVM

```bash
LIMITED_MAXRAM_JAVA_SIZE_MB = LIMITED_RAM_CONTAINER_CGROUP_SIZE_MB - STOCK_SIZE_MB
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä—É—é JVM –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ —Ä–∏—Å–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Non-Heap –æ–±–ª–∞—Å—Ç–µ–π JVM

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–ª–∞—Å—Ç–µ–π –ø–∞–º—è—Ç–∏:

| –û–±–ª–∞—Å—Ç—å                    | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                    | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                 |
|----------------------------|-------------------------------|-----------------------|----------------------------|
| **Code Cache**             | `RESERVED_CODE_CACHE_SIZE_MB` | 64 MB                 | –ö–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JIT –∫–æ–¥    |
| **Metaspace**              | `MAX_METASPACE_SIZE_MB`       | 80 MB                 | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–≤         |
| **Direct Buffers**         | `DIRECT_BYTES_BUFFERS_MB`     | 10 MB                 | NIO –±—É—Ñ–µ—Ä—ã                 |
| **Compressed Class Space** | `COMPRESSED_CLASS_SPACE_MB`   | 16 MB                 | –°–∂–∞—Ç—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –∫–ª–∞—Å—Å—ã |

```bash
NON_HEAP_SIZE_MB = RESERVED_CODE_CACHE_SIZE_MB + MAX_METASPACE_SIZE_MB + 
                   DIRECT_BYTES_BUFFERS_MB + COMPRESSED_CLASS_SPACE_MB
```

### 6. –†–∞—Å—á–µ—Ç Heap –ø–∞–º—è—Ç–∏

#### –≠—Ç–∞–ø 1: –ü–∞–º—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞—è –¥–ª—è Heap + GC
```bash
HEAP_GC_SIZE_MB = LIMITED_MAXRAM_JAVA_SIZE_MB - NON_HEAP_SIZE_MB
```

#### –≠—Ç–∞–ø 2: –†–µ–∑–µ—Ä–≤ –¥–ª—è GC overhead
```bash
OVERHEAD_GC_SIZE_PERCENT = 5  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5%
OVERHEAD_GC_SIZE_MB = (HEAP_GC_SIZE_MB * OVERHEAD_GC_SIZE_PERCENT) / 100
```

#### –≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä Heap
```bash
HEAP_SIZE_MB = HEAP_GC_SIZE_MB - OVERHEAD_GC_SIZE_MB
```

#### –≠—Ç–∞–ø 4: –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç MaxRAM –¥–ª—è JVM
```bash
MAX_RAM_PERCENTAGE = (HEAP_SIZE_MB * 100) / LIMITED_MAXRAM_JAVA_SIZE_MB
```

## JVM —Ñ–ª–∞–≥–∏ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **`-XX:+UseContainerSupport`** - –í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **`-XX:MaxRAM="${LIMITED_MAXRAM_JAVA_SIZE_MB}m"`** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è JVM
- **`-XX:MaxRAMPercentage="$MAX_RAM_PERCENTAGE"`** - –ü—Ä–æ—Ü–µ–Ω—Ç MaxRAM –¥–ª—è heap

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- **`-XX:+ExitOnOutOfMemoryError`** - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ OOM
- **`-XX:MaxMetaspaceSize="${MAX_METASPACE_SIZE_MB}m"`** - –õ–∏–º–∏—Ç Metaspace

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **`-XX:+SegmentedCodeCache`** - –°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π code cache –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **`-XX:ReservedCodeCacheSize="${RESERVED_CODE_CACHE_SIZE_MB}m"`** - –†–∞–∑–º–µ—Ä code cache

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
- **`$JAVA_OPTS_OVERRIDE`** - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–ø—Ü–∏–π

## –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–°–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:

```bash
export TOMCAT_THREADS_MAX=$TOMCAT_THREADS_MAX
export TOMCAT_THREADS_MIN=$TOMCAT_THREADS_MIN  
export HIKARI_DB_MAXIMUM_POOL_SIZE=$HIKARI_DB_MAXIMUM_POOL_SIZE
export HIKARI_DB_MINIMUM_IDLE_SIZE=$HIKARI_DB_MINIMUM_IDLE_SIZE
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞

### –î–∞–Ω–æ:
- –õ–∏–º–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: **512 MB**
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### –†–∞—Å—á–µ—Ç:

1. **–°–∫–ª–∞–¥—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã:**
   ```
   STOCK_SIZE_MB = (100/2) + 10 + 120 = 180 MB
   ```

2. **–î–æ—Å—Ç—É–ø–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è JVM:**
   ```
   LIMITED_MAXRAM_JAVA_SIZE_MB = 512 - 180 = 332 MB
   ```

3. **Non-heap –ø–∞–º—è—Ç—å:**
   ```
   NON_HEAP_SIZE_MB = 64 + 80 + 10 + 16 = 170 MB
   ```

4. **–ü–∞–º—è—Ç—å –¥–ª—è Heap + GC:**
   ```
   HEAP_GC_SIZE_MB = 332 - 170 = 162 MB
   ```

5. **GC overhead:**
   ```
   OVERHEAD_GC_SIZE_MB = (162 * 5) / 100 = 8 MB
   ```

6. **–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä Heap:**
   ```
   HEAP_SIZE_MB = 162 - 8 = 154 MB
   ```

7. **–ü—Ä–æ—Ü–µ–Ω—Ç RAM –¥–ª—è heap:**
   ```
   MAX_RAM_PERCENTAGE = (154 * 100) / 332 = 46%
   ```

### –†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ Java:

```bash
exec java \
  -XX:+UseContainerSupport \
  -XX:+ExitOnOutOfMemoryError \
  -XX:MaxRAM="332m" \
  -XX:MaxRAMPercentage="46" \
  -XX:+SegmentedCodeCache \
  -XX:ReservedCodeCacheSize="64m" \
  -XX:MaxMetaspaceSize="80m" \
  -jar /app/app.jar
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### Verbose —Ä–µ–∂–∏–º (`-v`)

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å —Ñ–ª–∞–≥–æ–º `-v` —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```bash
# –í–µ—Ä—Å–∏—è cgroups
Cgroups v2 are used

# –†–∞—Å—á–µ—Ç—ã –ø–∞–º—è—Ç–∏
LIMITED_MAXRAM_JAVA_SIZE_MB=332
HEAP_SIZE_MB=154
MAX_RAM_PERCENTAGE=46
```

**–ë–µ–∑ —Ñ–ª–∞–≥–∞ `-v`** - –Ω–∏–∫–∞–∫–∏—Ö –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è, —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

| –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ | Heap            | –°—Ç–∞—Ç—É—Å              |
|-------------------|-----------------|---------------------|
| **‚â§ 352 MB**      | ‚ùå –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π | –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç         |
| **353 MB**        | üî¥ 3 MB         | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –º–∏–Ω–∏–º—É–º |
| **400 MB**        | üü° 47 MB        | –ë–∞–∑–æ–≤—ã–π             |
| **512 MB**        | üü¢ 154 MB       | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π       |
| **768 MB**        | üü¢ 380 MB       | –ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π          |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:

1. **–î–ª—è –≤—ã—Å–æ–∫–æ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** - —É–≤–µ–ª–∏—á—å—Ç–µ `TOMCAT_THREADS_MAX`
2. **–î–ª—è –ë–î-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** - —É–≤–µ–ª–∏—á—å—Ç–µ `HIKARI_DB_MAXIMUM_POOL_SIZE`
3. **–î–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–ª–∞—Å—Å–æ–≤** - —É–≤–µ–ª–∏—á—å—Ç–µ `MAX_METASPACE_SIZE_MB`
4. **–ü—Ä–∏ —á–∞—Å—Ç—ã—Ö OOM** - —É–º–µ–Ω—å—à–∏—Ç–µ `OVERHEAD_GC_SIZE_PERCENT` –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç —Å OOM
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ heap/non-heap –ø–∞–º—è—Ç–∏, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ GC
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å—Ç–µ `OVERHEAD_GC_SIZE_PERCENT` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π GC —á–µ—Ä–µ–∑ `JAVA_OPTS_OVERRIDE`.

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–≥–æ database connections timeout
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å—Ç–µ `HIKARI_DB_MAXIMUM_POOL_SIZE` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
